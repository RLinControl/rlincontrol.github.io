<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reinforcement Learning in Control</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <!-- Content Section -->
    <section class="section content visible" id="content"> <!-- Added 'visible' class to ensure content is displayed -->
        <div class="content-wrapper">
            <!-- Tabs Sidebar -->
            <div class="tabs-sidebar" id="tabsSidebar">
                <div class="tabs-title">
                    <h3>Reinforcement Learning in Control</h3>
                </div>
                <div class="tabs">
                    <button class="tab" data-tab="overview"> Course Overview</button>
                    <button class="tab" data-tab="slides"> Lecture Slides</button>
                    <button class="tab" data-tab="homeworks"> Homeworks</button>
                    <button class="tab" data-tab="seminars"> Seminars</button>
                    <button class="tab" data-tab="projects"> Projects</button>
                    <button class="tab" data-tab="calendar"> Calendar</button>
                </div>
                <div style="flex:1"></div>
                <div style="padding: 2rem 1.5rem 0.5rem 1.5rem; margin-top:auto;">
                  <button id="themeToggleBtn" style="width:100%; padding:0.7rem 1rem; border-radius:8px; border:none; background:#222; color:#fff; font-size:1rem; font-weight:600; cursor:pointer; transition:background 0.2s, color 0.2s;">üåô Dark Mode</button>
                </div>
            </div>

        </div>
    </section>

    <!-- Full Page Tab Content -->
    <div class="tab-full-page" id="tabFullPage">
        <div class="tab-full-content">
            <div class="tab-sidebar-full">
                <div class="tabs-title">
                    <h3>Reinforcement Learning in Control</h3>
                </div>
                <div class="tabs">
                    <button class="tab tab-full" data-tab="overview"> Course Overview</button>
                    <button class="tab tab-full" data-tab="slides"> Lecture Slides</button>
                    <button class="tab tab-full" data-tab="homeworks"> Homeworks</button>
                    <button class="tab tab-full" data-tab="seminars"> Seminars</button>
                    <button class="tab tab-full" data-tab="projects"> Projects</button>
                    <button class="tab tab-full" data-tab="calendar"> Calendar</button>
                </div>
                <div style="flex:1"></div>
                <div style="padding: 2rem 1.5rem 0.5rem 1.5rem; margin-top:auto;">
                  <button id="themeToggleBtnFull" style="width:100%; padding:0.7rem 1rem; border-radius:8px; border:none; background:#222; color:#fff; font-size:1rem; font-weight:600; cursor:pointer; transition:background 0.2s, color 0.2s;">üåô Dark Mode</button>
                </div>
            </div>
            <div class="tab-content-main">
                <div class="tab-content" id="tabContent">
                    <!-- Content will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ensure content is visible on page load
        document.querySelector('.content').classList.add('visible');
        // Show Course Overview tab by default
        window.addEventListener('DOMContentLoaded', function() {
            const tabFullPage = document.getElementById('tabFullPage');
            const tabContent = document.getElementById('tabContent');
            tabFullPage.classList.add('visible');
            document.body.style.overflow = 'hidden';
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            // Use URL hash for tab persistence
            let tabName = window.location.hash ? window.location.hash.replace('#', '') : 'overview';
            let sidebarTab = document.querySelector('.tabs-sidebar .tab[data-tab="' + tabName + '"]');
            let fullTab = document.querySelector('.tab.tab-full[data-tab="' + tabName + '"]');
            if (sidebarTab) sidebarTab.classList.add('active');
            if (fullTab) fullTab.classList.add('active');
            if (fullTab) {
                fullTab.click();
            } else if (sidebarTab) {
                sidebarTab.click();
            }
        });

        // Tab functionality
        const tabs = document.querySelectorAll('.tab');
        const tabFullPage = document.getElementById('tabFullPage');
        const tabContent = document.getElementById('tabContent');

        const tabData = {
            slides: {
                title: 'Lecture Slides',
                message: 'Lecture slides will be uploaded here.'
            },
            homeworks: {
                title: 'Homeworks',
                message: 'Homework assignments will be posted here.'
            },
            
            projects: {
                title: 'Projects',
                message: 'Course projects and guidelines will be posted here.'
            },
        };

        // Handle tab clicks for course materials
        // Handle tab clicks for course materials ‚Äî MODULAR VERSION
        tabs.forEach(tab => { 
            tab.addEventListener('click', async () => {
                const tabName = tab.getAttribute('data-tab');

                // Update URL hash for tab persistence
                if (tabName) {
                    window.location.hash = tabName;
                }

                // Handle homepage tab (close full page)
                if (tabName === 'homepage') {
                    if (tabFullPage.classList.contains('visible')) {
                        tabFullPage.classList.remove('visible');
                        document.body.style.overflow = 'auto';
                    }
                    document.querySelector('.hero')?.scrollIntoView({ behavior: 'smooth' });
                    tabs.forEach(t => t.classList.remove('active'));
                    return;
                }

                // Update active state
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });

                // --- üéØ GENERIC FETCH LOADER ---
                let content = '';

                try {
                    // Try to load the HTML file for this tab
                    const response = await fetch(`tabs/${tabName}.html`);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: tabs/${tabName}.html not found`);
                    }
                    content = await response.text();
                } catch (error) {
                    console.warn(`Failed to load tabs/${tabName}.html. Using fallback.`, error);

                    // Fallback: Use simple message from tabData for basic tabs
                    const data = tabData[tabName];
                    if (data) {
                        content = `
                            <div class="demo-message">
                                <h3>${data.title}</h3>
                                <p>${data.message}</p>
                                <p>Stay tuned for updates!</p>
                            </div>
                        `;
                    } else {
                        content = `<div class="demo-message"><p>Content for "${tabName}" is not available.</p></div>`;
                    }
                }

                // Inject the loaded (or fallback) content
                tabContent.innerHTML = content;
                
                // Set active tab attribute for CSS targeting
                tabContent.setAttribute('data-active-tab', tabName);

                document.querySelector('.tab-content-main').scrollTop = 0;
                
                // --- üñºÔ∏è SPECIAL CASE: Update logo for 'overview' tab after injection ---
                if (tabName === 'overview') {
                    const logo = document.getElementById('iustLogo');
                    if (logo) {
                        const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
                        logo.src = theme === 'dark'
                            ? 'Images/IUST_logo_solid_black.svg_.png'
                            : 'Images/IUST_logo_color.png';
                    }
                }

                // Show full page
                tabFullPage.classList.add('visible');
                document.body.style.overflow = 'hidden';
            });
        });

        // Handle escape key to close full page
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && tabFullPage.classList.contains('visible')) {
                tabFullPage.classList.remove('visible');
                document.body.style.overflow = 'auto';
                tabs.forEach(t => t.classList.remove('active'));
            }
        });

        // Prevent body scroll when full page is open (but allow scrolling inside tab content)
        // Removed e.preventDefault() to allow scrolling in the overview and other tab pages

        // Add smooth transitions for better UX
        window.addEventListener('load', () => {
            document.body.style.opacity = '1';
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth <= 768) {
                // Mobile adjustments if needed
                const tabsSidebar = document.getElementById('tabsSidebar');
                if (tabsSidebar.classList.contains('visible')) {
                    // Ensure proper mobile layout
                    tabsSidebar.style.transform = 'translateY(0)';
                }
            }
        });

        // Click outside to close full page
        tabFullPage.addEventListener('click', (e) => {
            if (e.target === tabFullPage) {
                tabFullPage.classList.remove('visible');
                document.body.style.overflow = 'auto';
                tabs.forEach(t => t.classList.remove('active'));
            }
        });

        // Theme toggle logic
        function setTheme(mode) {
          if (mode === 'dark') {
            document.body.classList.add('dark-mode');
            localStorage.setItem('theme', 'dark');
            const btn = document.getElementById('themeToggleBtn');
            if (btn) {
              btn.innerHTML = '‚òÄÔ∏è Light Mode';
              btn.style.background = '#ffffff';
              btn.style.color = '#000000';
            }
            const btnFull = document.getElementById('themeToggleBtnFull');
            if (btnFull) {
              btnFull.innerHTML = '‚òÄÔ∏è Light Mode';
              btnFull.style.background = '#ffffff';
              btnFull.style.color = '#000000';
            }
          } else {
            document.body.classList.remove('dark-mode');
            localStorage.setItem('theme', 'light');
            const btn = document.getElementById('themeToggleBtn');
            if (btn) {
              btn.innerHTML = 'üåô Dark Mode';
              btn.style.background = '#222222';
              btn.style.color = '#ffffff';
            }
            const btnFull = document.getElementById('themeToggleBtnFull');
            if (btnFull) {
              btnFull.innerHTML = 'üåô Dark Mode';
              btnFull.style.background = '#222222';
              btnFull.style.color = '#ffffff';
            }
          }
          // Always update logo after theme change if present
          var logo = document.getElementById('iustLogo');
          if (logo) {
            var theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
            logo.src = theme === 'dark' ? 'Images/IUST_logo_solid_black.svg_.png' : 'Images/IUST_logo_color.png';
          }
        }
        window.addEventListener('DOMContentLoaded', function() {
          // Set theme from localStorage or default to light
          const saved = localStorage.getItem('theme');
          setTheme(saved === 'dark' ? 'dark' : 'light');
          // Ensure logo matches theme on load
          var logo = document.getElementById('iustLogo');
          if (logo) {
            const saved = localStorage.getItem('theme');
            if (saved === 'dark') {
              logo.src = 'Images/IUST_logo_solid_black.svg_.png';
            } else {
              logo.src = 'Images/IUST_logo_color.png';
            }
          }
          // Add event listeners
          const btn = document.getElementById('themeToggleBtn');
          if (btn) {
            btn.addEventListener('click', function() {
              if (document.body.classList.contains('dark-mode')) {
                setTheme('light');
              } else {
                setTheme('dark');
              }
            });
          }
          const btnFull = document.getElementById('themeToggleBtnFull');
          if (btnFull) {
            btnFull.addEventListener('click', function() {
              if (document.body.classList.contains('dark-mode')) {
                setTheme('light');
              } else {
                setTheme('dark');
              }
            });
          }
        });
    </script>
</body>
</html>