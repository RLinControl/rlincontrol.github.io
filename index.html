<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reinforcement Learning in Control</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div class="top-bar" id="topBar" style="display:none; position:fixed; top:0; left:0; width:100vw; z-index:1000; background:#fff; height:64px; display:flex; align-items:center; justify-content:space-between; padding:0 1.5rem;">
        <button id="hamburgerBtn" class="hamburger-btn" aria-label="Open menu" style="background:#222; color:#fff; border:none; border-radius:8px; padding:0.7rem 1rem; font-size:1.5rem; cursor:pointer;">
            &#9776;
        </button>
        <div class="top-bar-title" style="font-size:20.8px; font-weight:700; color:#4b6cff;">Reinforcement Learning in Control</div>
        <div class="top-bar-theme-toggle">
            <button id="themeToggleBtnTop" style="padding:0.7rem 1rem; border-radius:8px; border:none; background:#222; color:#fff; font-size:1rem; font-weight:600; cursor:pointer; transition:background 0.2s, color 0.2s;">üåô Dark Mode</button>
        </div>
    </div>
    <!-- Horizontal Tab Bar -->
    <div class="tabs-sidebar" id="tabsSidebar">
        <div class="tabs-title">
            <h3>Reinforcement Learning in Control</h3>
        </div>
        <div class="tabs">
            <button class="tab" data-tab="overview">Course Overview</button>
            <button class="tab" data-tab="syllabus">Syllabus</button>
            <button class="tab" data-tab="homeworks">Homeworks</button>
            <button class="tab" data-tab="seminars">Seminars</button>
            <button class="tab" data-tab="projects">Projects</button>
            <button class="tab" data-tab="calendar">Calendar</button>
        </div>
        <div class="theme-toggle-container">
            <button id="themeToggleBtn" style="padding:0.7rem 1rem; border-radius:8px; border:none; background:#222; color:#fff; font-size:1rem; font-weight:600; cursor:pointer; transition:background 0.2s, color 0.2s;">üåô Dark Mode</button>
        </div>
    </div>

    <!-- Content Section -->
    <section class="section content visible" id="content">
        <div class="content-wrapper">
            <!-- Full Page Tab Content -->
            <div class="tab-full-page" id="tabFullPage">
                <div class="tab-content-main">
                    <div class="tab-content" id="tabContent">
                        <!-- Content will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Ensure content is visible on page load
        document.querySelector('.content').classList.add('visible');
        // Show Course Overview tab by default
        window.addEventListener('DOMContentLoaded', function() {
            const tabFullPage = document.getElementById('tabFullPage');
            const tabContent = document.getElementById('tabContent');
            tabFullPage.classList.add('visible');
            document.body.style.overflow = 'hidden';
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            // Use URL hash for tab persistence
            let tabName = window.location.hash ? window.location.hash.replace('#', '') : 'overview';
            let sidebarTab = document.querySelector('.tabs-sidebar .tab[data-tab="' + tabName + '"]');
            if (sidebarTab) sidebarTab.classList.add('active');
            if (sidebarTab) {
                sidebarTab.click();
            }
        });

        // Tab functionality
        const tabs = document.querySelectorAll('.tab');
        const tabFullPage = document.getElementById('tabFullPage');
        const tabContent = document.getElementById('tabContent');

        const tabData = {
            homeworks: {
                title: 'Homeworks',
                message: 'Homework assignments will be posted here.'
            },
            projects: {
                title: 'Projects',
                message: 'Course projects and guidelines will be posted here.'
            },
        };

        // Handle tab clicks for course materials
        tabs.forEach(tab => { 
            tab.addEventListener('click', async () => {
                const tabName = tab.getAttribute('data-tab');

                // Update URL hash for tab persistence
                if (tabName) {
                    window.location.hash = tabName;
                }

                // Update active state
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });

                // Generic fetch loader
                let content = '';
                try {
                    const response = await fetch(`tabs/${tabName}.html`);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: tabs/${tabName}.html not found`);
                    }
                    content = await response.text();
                } catch (error) {
                    console.warn(`Failed to load tabs/${tabName}.html. Using fallback.`, error);
                    const data = tabData[tabName];
                    if (data) {
                        content = `
                            <div class="demo-message">
                                <h3>${data.title}</h3>
                                <p>${data.message}</p>
                                <p>Stay tuned for updates!</p>
                            </div>
                        `;
                    } else {
                        content = `<div class="demo-message"><p>Content for "${tabName}" is not available.</p></div>`;
                    }
                }

                // Inject the loaded (or fallback) content
                tabContent.innerHTML = content;
                
                // Set active tab attribute for CSS targeting
                tabContent.setAttribute('data-active-tab', tabName);

                document.querySelector('.tab-content-main').scrollTop = 0;

                // Update logo for 'overview' tab
                if (tabName === 'overview') {
                    const logo = document.getElementById('iustLogo');
                    if (logo) {
                        const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
                        logo.src = theme === 'dark'
                            ? 'Images/IUST_logo_solid_black.svg_.png'
                            : 'Images/IUST_logo_color.png';
                    }
                }

                // Show full page
                tabFullPage.classList.add('visible');
                document.body.style.overflow = 'hidden';
            });
        });

        // Handle escape key to close full page
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && tabFullPage.classList.contains('visible')) {
                tabFullPage.classList.remove('visible');
                document.body.style.overflow = 'auto';
                tabs.forEach(t => t.classList.remove('active'));
            }
        });

        // Click outside to close full page
        tabFullPage.addEventListener('click', (e) => {
            if (e.target === tabFullPage) {
                tabFullPage.classList.remove('visible');
                document.body.style.overflow = 'auto';
                tabs.forEach(t => t.classList.remove('active'));
            }
        });

        // Theme toggle logic
        function setTheme(mode) {
            if (mode === 'dark') {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
                const btn = document.getElementById('themeToggleBtn');
                if (btn) {
                    btn.innerHTML = '‚òÄÔ∏è Light Mode';
                    btn.style.background = '#ffffff';
                    btn.style.color = '#000000';
                }
                const btnTop = document.getElementById('themeToggleBtnTop');
                if (btnTop) {
                    btnTop.innerHTML = '‚òÄÔ∏è Light Mode';
                    btnTop.style.background = '#ffffff';
                    btnTop.style.color = '#000000';
                }
                const topBar = document.getElementById('topBar');
                if (topBar) {
                    topBar.style.background = '#23272F'; // updated to requested color
                    topBar.style.boxShadow = 'none';
                    topBar.style.borderBottom = 'none';
                }
                const topBarTitle = document.querySelector('.top-bar-title');
                if (topBarTitle) {
                    topBarTitle.style.color = '#60A5FA';
                    topBarTitle.style.background = '#23272F'; // match top bar background
                }
                // Hamburger icon white, box black in dark mode
                const hamburgerBtn = document.getElementById('hamburgerBtn');
                if (hamburgerBtn) {
                    hamburgerBtn.style.color = '#fff';
                    hamburgerBtn.style.background = '#23272F';
                }
                // Set content background to dark
                const contentSection = document.querySelector('.content');
                if (contentSection) {
                    contentSection.style.background = '#23272F';
                }
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
                const btn = document.getElementById('themeToggleBtn');
                if (btn) {
                    btn.innerHTML = 'üåô Dark Mode';
                    btn.style.background = '#222222';
                    btn.style.color = '#ffffff';
                }
                const btnTop = document.getElementById('themeToggleBtnTop');
                if (btnTop) {
                    btnTop.innerHTML = 'üåô Dark Mode';
                    btnTop.style.background = '#222222';
                    btnTop.style.color = '#ffffff';
                }
                const topBar = document.getElementById('topBar');
                if (topBar) {
                    topBar.style.background = '#fff';
                    topBar.style.boxShadow = 'none';
                    topBar.style.borderBottom = 'none';
                }
                const topBarTitle = document.querySelector('.top-bar-title');
                if (topBarTitle) {
                    topBarTitle.style.color = '#4b6cff';
                    topBarTitle.style.background = '#fff';
                }
                // Hamburger icon black, box white in light mode
                const hamburgerBtn = document.getElementById('hamburgerBtn');
                if (hamburgerBtn) {
                    hamburgerBtn.style.color = '#000';
                    hamburgerBtn.style.background = '#fff';
                }
                // Set content background to light
                const contentSection = document.querySelector('.content');
                if (contentSection) {
                    contentSection.style.background = '#fff';
                }
            }
            // Update logo after theme change
            const logo = document.getElementById('iustLogo');
            if (logo) {
                const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
                logo.src = theme === 'dark' ? 'Images/IUST_logo_solid_black.svg_.png' : 'Images/IUST_logo_color.png';
            }
        }

        window.addEventListener('DOMContentLoaded', function() {
            const saved = localStorage.getItem('theme');
            setTheme(saved === 'dark' ? 'dark' : 'light');
            const btn = document.getElementById('themeToggleBtn');
            if (btn) {
                btn.addEventListener('click', function() {
                    if (document.body.classList.contains('dark-mode')) {
                        setTheme('light');
                    } else {
                        setTheme('dark');
                    }
                });
            }
            // Add event listener for top bar theme toggle
            const btnTop = document.getElementById('themeToggleBtnTop');
            if (btnTop) {
                btnTop.addEventListener('click', function() {
                    if (document.body.classList.contains('dark-mode')) {
                        setTheme('light');
                    } else {
                        setTheme('dark');
                    }
                });
            }
        });

        // Hamburger menu logic
        function handleSidebarDisplay() {
            const sidebar = document.getElementById('tabsSidebar');
            const hamburger = document.getElementById('hamburgerBtn');
            const topBar = document.getElementById('topBar');
            if (window.innerWidth <= 1470) {
                sidebar.style.display = 'none';
                topBar.style.display = 'flex';
                // Make top bar title and theme toggle slightly smaller in compressed mode
                const topBarTitle = document.querySelector('.top-bar-title');
                if (topBarTitle) {
                    topBarTitle.style.fontSize = '1.1rem'; // slightly smaller
                }
                const topBarThemeToggle = document.querySelector('.top-bar-theme-toggle button');
                if (topBarThemeToggle) {
                    topBarThemeToggle.style.fontSize = '0.95rem'; // slightly smaller
                    topBarThemeToggle.style.padding = '0.5rem 0.8rem';
                }
            } else {
                sidebar.style.display = '';
                sidebar.style.position = '';
                sidebar.style.top = '';
                sidebar.style.left = '';
                sidebar.style.height = '';
                sidebar.style.zIndex = '';
                sidebar.style.background = '';
                topBar.style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        window.addEventListener('resize', handleSidebarDisplay);
        window.addEventListener('DOMContentLoaded', handleSidebarDisplay);
        document.getElementById('hamburgerBtn').addEventListener('click', function() {
            const sidebar = document.getElementById('tabsSidebar');
            if (window.innerWidth <= 1470) {
                if (sidebar.style.display === 'block') {
                    sidebar.style.display = 'none';
                    document.body.style.overflow = 'auto';
                } else {
                    sidebar.style.display = 'block';
                    sidebar.style.position = 'fixed';
                    sidebar.style.top = '0'; // start from top of window
                    sidebar.style.left = '0';
                    sidebar.style.height = '100vh'; // full viewport height
                    sidebar.style.width = '250px'; // reduced width
                    sidebar.style.zIndex = '1002';
                    // Set sidebar background based on theme
                    if (document.body.classList.contains('dark-mode')) {
                        sidebar.style.background = '#23272F';
                    } else {
                        sidebar.style.background = '#fff';
                    }
                    const tabsContainer = sidebar.querySelector('.tabs');
                    tabsContainer.style.flexDirection = 'column';
                    tabsContainer.style.display = 'flex';
                    tabsContainer.style.gap = '0.5rem';
                    tabsContainer.style.marginTop = '3.5rem'; // ensure tabs start below back arrow
                    tabsContainer.style.alignItems = 'flex-start'; // left align tabs
                    // Hide course name and theme toggle in sidebar
                    sidebar.querySelector('.tabs-title').style.display = 'none';
                    sidebar.querySelector('.theme-toggle-container').style.display = 'none';
                    document.body.style.overflow = 'hidden';
                    // Add back button if not present
                    if (!sidebar.querySelector('.sidebar-back-btn')) {
                        const backBtn = document.createElement('button');
                        backBtn.className = 'sidebar-back-btn';
                        backBtn.innerHTML = '‚Üê Back';
                        // Match tab font, color, and margin
                        backBtn.style.position = 'absolute';
                        backBtn.style.top = '16px';
                        backBtn.style.left = '0';
                        backBtn.style.paddingLeft = '2rem'; // match tab left padding
                        backBtn.style.background = 'transparent';
                        // Always use explicit color for visibility
                        if (document.body.classList.contains('dark-mode')) {
                            backBtn.style.color = '#60A5FA';
                        } else {
                            backBtn.style.color = '#4b6cff';
                        }
                        // Get tab font size and weight
                        const tabSample = sidebar.querySelector('.tab');
                        let tabFontSize = '';
                        let tabFontWeight = '';
                        if (tabSample) {
                            const tabStyles = window.getComputedStyle(tabSample);
                            tabFontSize = tabStyles.fontSize;
                            tabFontWeight = tabStyles.fontWeight;
                        } else {
                            tabFontSize = '16px';
                            tabFontWeight = '400';
                        }
                        backBtn.style.fontSize = tabFontSize;
                        backBtn.style.fontWeight = tabFontWeight;
                        backBtn.style.border = 'none';
                        backBtn.style.cursor = 'pointer';
                        backBtn.style.zIndex = '1003';
                        backBtn.style.display = 'flex';
                        backBtn.style.alignItems = 'center';
                        backBtn.style.height = '2.5rem';
                        backBtn.addEventListener('click', function() {
                            sidebar.style.display = 'none';
                            document.body.style.overflow = 'auto';
                        });
                        sidebar.appendChild(backBtn);
                    }
                }
            }
        });
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('tabsSidebar');
            if (window.innerWidth > 1470) {
                sidebar.style.position = '';
                sidebar.style.top = '';
                sidebar.style.left = '';
                sidebar.style.height = '';
                sidebar.style.width = '';
                sidebar.style.zIndex = '';
                sidebar.style.background = '';
                sidebar.querySelector('.tabs').style.flexDirection = '';
                sidebar.querySelector('.tabs').style.display = '';
                sidebar.querySelector('.tabs').style.gap = '';
                sidebar.querySelector('.tabs').style.marginTop = '';
                // Show course name and theme toggle in sidebar
                sidebar.querySelector('.tabs-title').style.display = '';
                sidebar.querySelector('.theme-toggle-container').style.display = '';
                // Remove back button if present
                const backBtn = sidebar.querySelector('.sidebar-back-btn');
                if (backBtn) {
                    backBtn.remove();
                }
                // Reset tabs margin
                const tabsContainer = sidebar.querySelector('.tabs');
                if (tabsContainer) {
                    tabsContainer.style.marginTop = '';
                }
            }
        });
        document.getElementById('tabsSidebar').addEventListener('click', function(e) {
            // Remove sidebar auto-close on tab click in mobile mode
            // Previously:
            // if (window.innerWidth <= 1470 && e.target.classList.contains('tab')) {
            //     document.getElementById('tabsSidebar').style.display = 'none';
            //     document.body.style.overflow = 'auto';
            // }
        });
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('tabsSidebar');
            const hamburger = document.getElementById('hamburgerBtn');
            if (window.innerWidth <= 1470 && sidebar.style.display === 'block') {
                if (!sidebar.contains(e.target) && e.target !== hamburger) {
                    sidebar.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            }
        });
    </script>
</body>
</html>