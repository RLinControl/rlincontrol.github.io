<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reinforcement Learning in Control</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <!-- Horizontal Tab Bar -->
    <div class="tabs-sidebar" id="tabsSidebar">
        <div class="tabs-title">
            <h3>Reinforcement Learning in Control</h3>
        </div>
        <div class="tabs">
            <button class="tab" data-tab="overview">Course Overview</button>
            <button class="tab" data-tab="slides">Lecture Slides</button>
            <button class="tab" data-tab="homeworks">Homeworks</button>
            <button class="tab" data-tab="seminars">Seminars</button>
            <button class="tab" data-tab="projects">Projects</button>
            <button class="tab" data-tab="calendar">Calendar</button>
        </div>
        <div class="theme-toggle-container">
            <button id="themeToggleBtn" style="padding:0.7rem 1rem; border-radius:8px; border:none; background:#222; color:#fff; font-size:1rem; font-weight:600; cursor:pointer; transition:background 0.2s, color 0.2s;">üåô Dark Mode</button>
        </div>
    </div>

    <!-- Content Section -->
    <section class="section content visible" id="content">
        <div class="content-wrapper">
            <!-- Full Page Tab Content -->
            <div class="tab-full-page" id="tabFullPage">
                <div class="tab-content-main">
                    <div class="tab-content" id="tabContent">
                        <!-- Content will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Ensure content is visible on page load
        document.querySelector('.content').classList.add('visible');
        // Show Course Overview tab by default
        window.addEventListener('DOMContentLoaded', function() {
            const tabFullPage = document.getElementById('tabFullPage');
            const tabContent = document.getElementById('tabContent');
            tabFullPage.classList.add('visible');
            document.body.style.overflow = 'hidden';
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            // Use URL hash for tab persistence
            let tabName = window.location.hash ? window.location.hash.replace('#', '') : 'overview';
            let sidebarTab = document.querySelector('.tabs-sidebar .tab[data-tab="' + tabName + '"]');
            if (sidebarTab) sidebarTab.classList.add('active');
            if (sidebarTab) {
                sidebarTab.click();
            }
        });

        // Tab functionality
        const tabs = document.querySelectorAll('.tab');
        const tabFullPage = document.getElementById('tabFullPage');
        const tabContent = document.getElementById('tabContent');

        const tabData = {
            slides: {
                title: 'Lecture Slides',
                message: 'Lecture slides will be uploaded here.'
            },
            homeworks: {
                title: 'Homeworks',
                message: 'Homework assignments will be posted here.'
            },
            projects: {
                title: 'Projects',
                message: 'Course projects and guidelines will be posted here.'
            },
        };

        // Handle tab clicks for course materials
        tabs.forEach(tab => { 
            tab.addEventListener('click', async () => {
                const tabName = tab.getAttribute('data-tab');

                // Update URL hash for tab persistence
                if (tabName) {
                    window.location.hash = tabName;
                }

                // Update active state
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });

                // Generic fetch loader
                let content = '';
                try {
                    const response = await fetch(`tabs/${tabName}.html`);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: tabs/${tabName}.html not found`);
                    }
                    content = await response.text();
                } catch (error) {
                    console.warn(`Failed to load tabs/${tabName}.html. Using fallback.`, error);
                    const data = tabData[tabName];
                    if (data) {
                        content = `
                            <div class="demo-message">
                                <h3>${data.title}</h3>
                                <p>${data.message}</p>
                                <p>Stay tuned for updates!</p>
                            </div>
                        `;
                    } else {
                        content = `<div class="demo-message"><p>Content for "${tabName}" is not available.</p></div>`;
                    }
                }

                // Inject the loaded (or fallback) content
                tabContent.innerHTML = content;
                
                // Set active tab attribute for CSS targeting
                tabContent.setAttribute('data-active-tab', tabName);

                document.querySelector('.tab-content-main').scrollTop = 0;

                // Update logo for 'overview' tab
                if (tabName === 'overview') {
                    const logo = document.getElementById('iustLogo');
                    if (logo) {
                        const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
                        logo.src = theme === 'dark'
                            ? 'Images/IUST_logo_solid_black.svg_.png'
                            : 'Images/IUST_logo_color.png';
                    }
                }

                // Show full page
                tabFullPage.classList.add('visible');
                document.body.style.overflow = 'hidden';
            });
        });

        // Handle escape key to close full page
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && tabFullPage.classList.contains('visible')) {
                tabFullPage.classList.remove('visible');
                document.body.style.overflow = 'auto';
                tabs.forEach(t => t.classList.remove('active'));
            }
        });

        // Click outside to close full page
        tabFullPage.addEventListener('click', (e) => {
            if (e.target === tabFullPage) {
                tabFullPage.classList.remove('visible');
                document.body.style.overflow = 'auto';
                tabs.forEach(t => t.classList.remove('active'));
            }
        });

        // Theme toggle logic
        function setTheme(mode) {
            if (mode === 'dark') {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
                const btn = document.getElementById('themeToggleBtn');
                if (btn) {
                    btn.innerHTML = '‚òÄÔ∏è Light Mode';
                    btn.style.background = '#ffffff';
                    btn.style.color = '#000000';
                }
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
                const btn = document.getElementById('themeToggleBtn');
                if (btn) {
                    btn.innerHTML = 'üåô Dark Mode';
                    btn.style.background = '#222222';
                    btn.style.color = '#ffffff';
                }
            }
            // Update logo after theme change
            const logo = document.getElementById('iustLogo');
            if (logo) {
                const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
                logo.src = theme === 'dark' ? 'Images/IUST_logo_solid_black.svg_.png' : 'Images/IUST_logo_color.png';
            }
        }

        window.addEventListener('DOMContentLoaded', function() {
            const saved = localStorage.getItem('theme');
            setTheme(saved === 'dark' ? 'dark' : 'light');
            const btn = document.getElementById('themeToggleBtn');
            if (btn) {
                btn.addEventListener('click', function() {
                    if (document.body.classList.contains('dark-mode')) {
                        setTheme('light');
                    } else {
                        setTheme('dark');
                    }
                });
            }
        });
    </script>
</body>
</html>